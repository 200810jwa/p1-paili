<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Reimbursement</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
        .form-row {
            margin-top: 10px;
        }

        #receipt {
            display: flex;
            justify-content: right;
            align-items: flex-end;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row" style="background-color:#f0f7ff">
            <div class="col-2"></div>
            <div class="col text-center">
                <h2 id="title" style="margin:5px"></h2>

            </div>
            <div class="col-2 text-right">
                <button id="logout_btn" class="btn btn-info" style="margin:10px" onclick="goHome()">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row" style="padding:10px">
            <div class="col">
                <div class="form-group">
                    <form>
                        <div class="form-row">
                            <div class="col-2">
                                <label class="col text-left" for="amount">Amount</label>
                                <input id="amount" type="number" class="form-control">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col">
                                <label class="col text-left">Type</label>
                                <select id="type_id" class="custom-select">
                                    <option value=1>Lodging</option>
                                    <option value=2>Travel</option>
                                    <option value=3>Food</option>
                                    <option value=0>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col">
                                <label class="col text-left">Description</label>
                                <textarea id="description" class="form-control" rows=3></textarea>
                            </div>
                        </div>
                        <div class="form-row" style="margin-left:10px">
                            <div class="col"> 
                            <label class="custom-file-label text-left" for="receipt">Upload Receipt</label>
                            <div class="custom-file">
                            <input id="receipt" type="file" class="custom-file-input text-right"
                                accept=".png, .bmp, .jpg, .gif, .pdf">
                            </div>
                        </div>
                        </div>
                        <div class="form-row" style="margin-top:20px">
                            <button class="btn btn-primary btn-block"
                                onclick="createReimbursement(); return false;">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let user_id = sessionStorage.getItem("user_id");
        let today = new Date().getTime();

        async function createReimbursement() {
            let amount = document.getElementById("amount").value;
            let type_id = document.getElementById("type_id").value;
            let description = document.getElementById("description").value;
            let receipt = document.getElementById("receipt").files[0];

            let r_file = new FormData();
            r_file.append("receipt", receipt);

            // null check
            if (amount && type_id && receipt) {

                // console.log(amount);
                // console.log(type_id);
                // console.log(description);
                // console.log(receipt);

                // setTimeout(5000);

                let r = {
                    amount: amount,
                    type_ID: type_id,
                    description: description,
                    author: user_id,
                };

                console.log(JSON.stringify(r));

                try {
                    let response = await fetch("http://localhost:8006/project1/apply", {
                        method: 'PUT',
                        body: JSON.stringify(r)
                    });

                    response = await fetch("http://localhost:8006/project1/apply", {
                        method: 'POST',
                        body: r_file
                    });
                    // 

                } catch (error) {
                    alert("Error submitting your reimbursement. Please try again.")
                    console.log(error);
                }
            } else {
                alert("Missing required fields!");
            }

            window.location.href = "http://localhost:8006/project1/EmployeeHome";
        }

        async function goHome() {
            sessionStorage.clear();
            window.location.href = "http://localhost:8006/project1/index";
        }

    </script>

</body>

</html>